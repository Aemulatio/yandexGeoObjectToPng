"use strict";

// eslint-disable-next-line @typescript-eslint/no-unused-vars
class Geo2Png {
  _canvasId = "canvas_" + Math.random().toString(36).substring(2, 7);
  _mapId = "map_" + Math.random().toString(36).substring(2, 7);
  _download = false;
  _zoomToBounds = false;
  _padding = 10;
  get geoObject() {
    return this._geoObject;
  }
  get padding() {
    return this._padding;
  }
  get canvasId() {
    return this._canvasId;
  }
  get mapId() {
    return this._mapId;
  }
  get zoomToBounds() {
    return this._zoomToBounds;
  }
  get download() {
    return this._download;
  }

  /**
   *  @param geoObject - Объект с карты, который нужно перерисовать
   *  @param padding - Расстояние от границ канваса до объекта
   *  @param download - Скачивать ли изображение после того как отрисуется
   *  @param zoomToBounds - Рисовать с текущим зумом или вписать в квадрат со стороной 500px?
   *
   * */
  constructor(geoObject, padding = 10, download = false, zoomToBounds = false) {
    this._geoObject = geoObject;
    this._download = download;
    this._zoomToBounds = zoomToBounds;
    this._padding = padding;
    console.log(geoObject.options.getAll());
  }
  _createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.setAttribute("id", this.canvasId);
    document.body.appendChild(canvas);
    return canvas;
  }
  _createMap(bounds, type) {
    if (!("ymaps" in window)) return;
    const mapContainer = document.createElement("div");
    mapContainer.setAttribute("id", this.mapId);
    mapContainer.style.width = "500px";
    mapContainer.style.height = "500px";
    document.body.appendChild(mapContainer);
    const map = new window.ymaps.Map(this.mapId, {
      bounds
    }, {
      avoidFractionalZoom: false
    });
    if (type === "Polygon") {
      const Polygon = new window.ymaps.Polygon(this.geoObject.geometry?.getCoordinates(), {}, this.geoObject.options.getAll());
      map.geoObjects.add(Polygon);
    } else {
      // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-ignore
      const Polygon = new window.ymaps.Rectangle(this.geoObject.geometry?.getCoordinates(), {}, this.geoObject.options.getAll());
      map.geoObjects.add(Polygon);
    }
    return [map, mapContainer];
  }
  createPng() {
    if (!this.geoObject || !this.geoObject.geometry) return;
    if (this.geoObject.geometry.getType() === "Polygon") {
      if (this.zoomToBounds) {
        if (!("getPixelGeometry" in this.geoObject.geometry)) return;
        const pixelCoordinates = this._zoomed();
        const [canvasHeight, canvasWidth] = this._calculateCanvasDimensionsForPolygon(pixelCoordinates);
        const canvas = this._createCanvas();
        this._changeCanvasSizes(canvas, canvasWidth, canvasHeight);
        const ctx = canvas.getContext("2d");
        const config = this.geoObject.options.getAll();
        ctx.strokeStyle = "strokeColor" in config ? config?.strokeColor : "#0000FF";
        ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
        ctx.fillStyle = "fillColor" in config ? config.fillColor : "#7df9ff33";
        this._drawPolygon(pixelCoordinates, ctx);
      } else {
        this._withoutZoom();
      }
    } else {
      if (this.zoomToBounds) {
        //rectangle
        if (!this.geoObject || !this.geoObject.geometry) return;
        if (!("getPixelGeometry" in this.geoObject.geometry)) return;
        const pixelCoordinates = this._zoomed();
        const canvasHeight = Math.round(Math.max(...pixelCoordinates.flat())),
          canvasWidth = Math.round(Math.max(...pixelCoordinates.flat()));
        const canvas = this._createCanvas();
        this._changeCanvasSizes(canvas, canvasWidth, canvasHeight);
        const ctx = canvas.getContext("2d");
        const config = this.geoObject.options.getAll();
        ctx.strokeStyle = "strokeColor" in config ? config?.strokeColor : "#0000FF";
        ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
        ctx.fillStyle = "fillColor" in config ? config.fillColor : "#7df9ff33";
        console.log(pixelCoordinates);
        this._drawRectangle(pixelCoordinates, ctx, config);
      } else {
        if (!("getPixelGeometry" in this.geoObject.geometry)) return;
        const pixelBounds = this.geoObject.geometry.getPixelGeometry().getBounds();
        const deltaX = this._calculateDeltaX(pixelBounds);
        const deltaY = this._calculateDeltaY(pixelBounds);
        const canvas = this._createCanvas();
        const pixelCoordinates = (this.geoObject.geometry?.getPixelGeometry()).getCoordinates().map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
        const canvasHeight = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[1]))),
          canvasWidth = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[0])));
        this._changeCanvasSizes(canvas, canvasWidth, canvasHeight);
        const ctx = canvas.getContext("2d");
        const config = this.geoObject.options.getAll();
        console.log(config);
        const strokeStyle = this._calculateStyle(config, "strokeColor", "strokeOpacity") || "rgba(0,0,255,0.1)";
        console.log("strokeStyle: ", strokeStyle);
        ctx.strokeStyle = strokeStyle;
        ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
        ctx.fillStyle = this._calculateStyle(config, "fillColor", "fillOpacity") || "#7df9ff33";
        this._drawRectangle(pixelCoordinates, ctx, config);
      }
    }
  }
  _withoutZoom() {
    if (!this.geoObject || !this.geoObject.geometry) return;
    if (!("getPixelGeometry" in this.geoObject.geometry)) return;
    const pixelBounds = this.geoObject.geometry.getPixelGeometry().getBounds();
    const deltaX = this._calculateDeltaX(pixelBounds);
    const deltaY = this._calculateDeltaY(pixelBounds);
    const canvas = this._createCanvas();
    const pixelCoordinates = (this.geoObject.geometry?.getPixelGeometry()).getCoordinates()[0].map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
    const [canvasHeight, canvasWidth] = this._calculateCanvasDimensionsForPolygon(pixelCoordinates);
    this._changeCanvasSizes(canvas, canvasWidth, canvasHeight);
    const ctx = canvas.getContext("2d");
    const config = this.geoObject.options.getAll();
    ctx.strokeStyle = "strokeColor" in config ? config?.strokeColor : "#0000FF";
    ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
    ctx.fillStyle = "fillColor" in config ? config.fillColor : "#7df9ff33";
    this._drawPolygon(pixelCoordinates, ctx);
  }
  _drawRectangle(pixelCoordinates, ctx, config) {
    const startPoint = [pixelCoordinates[0][0], pixelCoordinates[1][1]],
      width = pixelCoordinates[1][0] - pixelCoordinates[0][0],
      height = pixelCoordinates[0][1] - pixelCoordinates[1][1];
    ctx.beginPath();
    ctx.roundRect(startPoint[0], startPoint[1], width, height, config?.borderRadius || 0);
    ctx.stroke();
    ctx.fill();
  }
  _drawPolygon(pixelCoordinates, ctx) {
    ctx.beginPath();
    ctx.moveTo(pixelCoordinates[0][0], pixelCoordinates[0][1]);
    for (let i = 1; i < pixelCoordinates.length; i++) {
      ctx.lineTo(pixelCoordinates[i][0], pixelCoordinates[i][1]);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.fill();
  }
  _zoomed() {
    if (!this.geoObject || !this.geoObject.geometry) return;
    if (!("getPixelGeometry" in this.geoObject.geometry)) return;
    const bounds = this.geoObject.geometry.getBounds();
    const type = this.geoObject.geometry.getType();
    const [map, mapContainer] = this._createMap(bounds, type);
    const object = map.geoObjects.getIterator().getNext();
    const pixelBounds = object.geometry?.getPixelGeometry().getBounds();
    const deltaX = this._calculateDeltaX(pixelBounds);
    const deltaY = this._calculateDeltaY(pixelBounds);
    if (type === "Polygon") {
      return (object.geometry?.getPixelGeometry()).getCoordinates()[0].map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
    }
    return (object.geometry?.getPixelGeometry()).getCoordinates().map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
  }
  _calculateStyle = (config, colorProperty, opacityProperty) => {
    let returnValue = "";
    if (colorProperty in config) {
      console.log("stroke");
      returnValue = config[colorProperty];
      if (opacityProperty in config) {
        if (returnValue.length === 9) {
          const hex = config[colorProperty];
          const opacity = parseInt(returnValue.slice(7), 16) / 255 * config[opacityProperty];
          const r = parseInt(hex.slice(1, 3), 16),
            g = parseInt(hex.slice(3, 5), 16),
            b = parseInt(hex.slice(5, 7), 16);
          return `rgba(${r},${g},${b},${opacity})`;
        } else {
          return config[colorProperty];
        }
      }
      return returnValue;
    }
    return returnValue;
  };
  _changeCanvasSizes(canvas, width, height) {
    canvas.width = width + this.padding;
    canvas.height = height + this.padding;
  }
  _calculateDeltaX(pixelBounds) {
    return Math.min(pixelBounds[0][0], pixelBounds[1][0]);
  }
  _calculateDeltaY(pixelBounds) {
    return Math.min(pixelBounds[0][1], pixelBounds[1][1]);
  }
  _calculateCanvasDimensionsForPolygon(pixelCoordinates) {
    return [Math.round(Math.max(...pixelCoordinates.flatMap(c => c[1]))), Math.round(Math.max(...pixelCoordinates.flatMap(c => c[0])))];
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHZW8yUG5nIiwiX2NhbnZhc0lkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiX21hcElkIiwiX2Rvd25sb2FkIiwiX3pvb21Ub0JvdW5kcyIsIl9wYWRkaW5nIiwiZ2VvT2JqZWN0IiwiX2dlb09iamVjdCIsInBhZGRpbmciLCJjYW52YXNJZCIsIm1hcElkIiwiem9vbVRvQm91bmRzIiwiZG93bmxvYWQiLCJjb25zdHJ1Y3RvciIsImNvbnNvbGUiLCJsb2ciLCJvcHRpb25zIiwiZ2V0QWxsIiwiX2NyZWF0ZUNhbnZhcyIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIl9jcmVhdGVNYXAiLCJib3VuZHMiLCJ0eXBlIiwid2luZG93IiwibWFwQ29udGFpbmVyIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsIm1hcCIsInltYXBzIiwiTWFwIiwiYXZvaWRGcmFjdGlvbmFsWm9vbSIsIlBvbHlnb24iLCJnZW9tZXRyeSIsImdldENvb3JkaW5hdGVzIiwiZ2VvT2JqZWN0cyIsImFkZCIsIlJlY3RhbmdsZSIsImNyZWF0ZVBuZyIsImdldFR5cGUiLCJwaXhlbENvb3JkaW5hdGVzIiwiX3pvb21lZCIsImNhbnZhc0hlaWdodCIsImNhbnZhc1dpZHRoIiwiX2NhbGN1bGF0ZUNhbnZhc0RpbWVuc2lvbnNGb3JQb2x5Z29uIiwiX2NoYW5nZUNhbnZhc1NpemVzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImNvbmZpZyIsInN0cm9rZVN0eWxlIiwic3Ryb2tlQ29sb3IiLCJsaW5lV2lkdGgiLCJzdHJva2VXaWR0aCIsImZpbGxTdHlsZSIsImZpbGxDb2xvciIsIl9kcmF3UG9seWdvbiIsIl93aXRob3V0Wm9vbSIsInJvdW5kIiwibWF4IiwiZmxhdCIsIl9kcmF3UmVjdGFuZ2xlIiwicGl4ZWxCb3VuZHMiLCJnZXRQaXhlbEdlb21ldHJ5IiwiZ2V0Qm91bmRzIiwiZGVsdGFYIiwiX2NhbGN1bGF0ZURlbHRhWCIsImRlbHRhWSIsIl9jYWxjdWxhdGVEZWx0YVkiLCJwb2ludCIsImZsYXRNYXAiLCJjIiwiX2NhbGN1bGF0ZVN0eWxlIiwic3RhcnRQb2ludCIsImJlZ2luUGF0aCIsInJvdW5kUmVjdCIsImJvcmRlclJhZGl1cyIsInN0cm9rZSIsImZpbGwiLCJtb3ZlVG8iLCJpIiwibGVuZ3RoIiwibGluZVRvIiwiY2xvc2VQYXRoIiwib2JqZWN0IiwiZ2V0SXRlcmF0b3IiLCJnZXROZXh0IiwiY29sb3JQcm9wZXJ0eSIsIm9wYWNpdHlQcm9wZXJ0eSIsInJldHVyblZhbHVlIiwiaGV4Iiwib3BhY2l0eSIsInBhcnNlSW50Iiwic2xpY2UiLCJyIiwiZyIsImIiLCJtaW4iXSwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1xuICBHZW9PYmplY3QsXG4gIElQaXhlbFBvbHlnb25HZW9tZXRyeSxcbiAgSVBpeGVsUmVjdGFuZ2xlR2VvbWV0cnksXG4gIElQb2x5Z29uR2VvbWV0cnksXG4gIE1hcCxcbn0gZnJvbSBcInlhbmRleC1tYXBzXCI7XG5cbmludGVyZmFjZSBDb25maWcge1xuICBmaWxsQ29sb3I6IHN0cmluZztcbiAgZmlsbE9wYWNpdHk6IG51bWJlcjtcbiAgc3Ryb2tlQ29sb3I6IHN0cmluZztcbiAgc3Ryb2tlT3BhY2l0eTogbnVtYmVyO1xuICBzdHJva2VXaWR0aDogbnVtYmVyO1xuICBib3JkZXJSYWRpdXM6IG51bWJlcjtcbn1cblxudHlwZSBBdmFpbGFibGVHZW9PYmplY3RzVHlwZSA9IFwiUG9seWdvblwiIHwgXCJSZWN0YW5nbGVcIjtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuY2xhc3MgR2VvMlBuZyB7XG4gIF9nZW9PYmplY3QhOiBHZW9PYmplY3Q7XG4gIF9jYW52YXNJZDogc3RyaW5nID0gXCJjYW52YXNfXCIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgNyk7XG4gIF9tYXBJZDogc3RyaW5nID0gXCJtYXBfXCIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgNyk7XG4gIF9kb3dubG9hZDogYm9vbGVhbiA9IGZhbHNlO1xuICBfem9vbVRvQm91bmRzOiBib29sZWFuID0gZmFsc2U7XG4gIF9wYWRkaW5nOiBudW1iZXIgPSAxMDtcblxuICBnZXQgZ2VvT2JqZWN0KCkge1xuICAgIHJldHVybiB0aGlzLl9nZW9PYmplY3Q7XG4gIH1cblxuICBnZXQgcGFkZGluZygpIHtcbiAgICByZXR1cm4gdGhpcy5fcGFkZGluZztcbiAgfVxuXG4gIGdldCBjYW52YXNJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2FudmFzSWQ7XG4gIH1cblxuICBnZXQgbWFwSWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21hcElkO1xuICB9XG5cbiAgZ2V0IHpvb21Ub0JvdW5kcygpIHtcbiAgICByZXR1cm4gdGhpcy5fem9vbVRvQm91bmRzO1xuICB9XG5cbiAgZ2V0IGRvd25sb2FkKCkge1xuICAgIHJldHVybiB0aGlzLl9kb3dubG9hZDtcbiAgfVxuXG4gIC8qKlxuICAgKiAgQHBhcmFtIGdlb09iamVjdCAtINCe0LHRitC10LrRgiDRgSDQutCw0YDRgtGLLCDQutC+0YLQvtGA0YvQuSDQvdGD0LbQvdC+INC/0LXRgNC10YDQuNGB0L7QstCw0YLRjFxuICAgKiAgQHBhcmFtIHBhZGRpbmcgLSDQoNCw0YHRgdGC0L7Rj9C90LjQtSDQvtGCINCz0YDQsNC90LjRhiDQutCw0L3QstCw0YHQsCDQtNC+INC+0LHRitC10LrRgtCwXG4gICAqICBAcGFyYW0gZG93bmxvYWQgLSDQodC60LDRh9C40LLQsNGC0Ywg0LvQuCDQuNC30L7QsdGA0LDQttC10L3QuNC1INC/0L7RgdC70LUg0YLQvtCz0L4g0LrQsNC6INC+0YLRgNC40YHRg9C10YLRgdGPXG4gICAqICBAcGFyYW0gem9vbVRvQm91bmRzIC0g0KDQuNGB0L7QstCw0YLRjCDRgSDRgtC10LrRg9GJ0LjQvCDQt9GD0LzQvtC8INC40LvQuCDQstC/0LjRgdCw0YLRjCDQsiDQutCy0LDQtNGA0LDRgiDRgdC+INGB0YLQvtGA0L7QvdC+0LkgNTAwcHg/XG4gICAqXG4gICAqICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIGdlb09iamVjdDogR2VvT2JqZWN0LFxuICAgIHBhZGRpbmc6IG51bWJlciA9IDEwLFxuICAgIGRvd25sb2FkOiBib29sZWFuID0gZmFsc2UsXG4gICAgem9vbVRvQm91bmRzOiBib29sZWFuID0gZmFsc2UsXG4gICkge1xuICAgIHRoaXMuX2dlb09iamVjdCA9IGdlb09iamVjdDtcbiAgICB0aGlzLl9kb3dubG9hZCA9IGRvd25sb2FkO1xuICAgIHRoaXMuX3pvb21Ub0JvdW5kcyA9IHpvb21Ub0JvdW5kcztcbiAgICB0aGlzLl9wYWRkaW5nID0gcGFkZGluZztcbiAgICBjb25zb2xlLmxvZyhnZW9PYmplY3Qub3B0aW9ucy5nZXRBbGwoKSk7XG4gIH1cblxuICBfY3JlYXRlQ2FudmFzKCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aGlzLmNhbnZhc0lkKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxuXG4gIF9jcmVhdGVNYXAoXG4gICAgYm91bmRzOiBudW1iZXJbXVtdLFxuICAgIHR5cGU6IEF2YWlsYWJsZUdlb09iamVjdHNUeXBlLFxuICApOiBbTWFwLCBIVE1MRGl2RWxlbWVudF0gfCB1bmRlZmluZWQge1xuICAgIGlmICghKFwieW1hcHNcIiBpbiB3aW5kb3cpKSByZXR1cm47XG4gICAgY29uc3QgbWFwQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtYXBDb250YWluZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgdGhpcy5tYXBJZCk7XG4gICAgbWFwQ29udGFpbmVyLnN0eWxlLndpZHRoID0gXCI1MDBweFwiO1xuICAgIG1hcENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBcIjUwMHB4XCI7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtYXBDb250YWluZXIpO1xuICAgIGNvbnN0IG1hcCA9IG5ldyB3aW5kb3cueW1hcHMuTWFwKFxuICAgICAgdGhpcy5tYXBJZCxcbiAgICAgIHtcbiAgICAgICAgYm91bmRzLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgYXZvaWRGcmFjdGlvbmFsWm9vbTogZmFsc2UsXG4gICAgICB9LFxuICAgICk7XG4gICAgaWYgKHR5cGUgPT09IFwiUG9seWdvblwiKSB7XG4gICAgICBjb25zdCBQb2x5Z29uID0gbmV3IHdpbmRvdy55bWFwcy5Qb2x5Z29uKFxuICAgICAgICAodGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkgYXMgSVBvbHlnb25HZW9tZXRyeSk/LmdldENvb3JkaW5hdGVzKCksXG4gICAgICAgIHt9LFxuICAgICAgICB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpLFxuICAgICAgKTtcbiAgICAgIG1hcC5nZW9PYmplY3RzLmFkZChQb2x5Z29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY29uc3QgUG9seWdvbiA9IG5ldyB3aW5kb3cueW1hcHMuUmVjdGFuZ2xlKFxuICAgICAgICAodGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkgYXMgSVBvbHlnb25HZW9tZXRyeSk/LmdldENvb3JkaW5hdGVzKCksXG4gICAgICAgIHt9LFxuICAgICAgICB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpLFxuICAgICAgKTtcbiAgICAgIG1hcC5nZW9PYmplY3RzLmFkZChQb2x5Z29uKTtcbiAgICB9XG4gICAgcmV0dXJuIFttYXAsIG1hcENvbnRhaW5lcl07XG4gIH1cblxuICBjcmVhdGVQbmcoKSB7XG4gICAgaWYgKCF0aGlzLmdlb09iamVjdCB8fCAhdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpIHJldHVybjtcbiAgICBpZiAodGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkuZ2V0VHlwZSgpID09PSBcIlBvbHlnb25cIikge1xuICAgICAgaWYgKHRoaXMuem9vbVRvQm91bmRzKSB7XG4gICAgICAgIGlmICghKFwiZ2V0UGl4ZWxHZW9tZXRyeVwiIGluIHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBwaXhlbENvb3JkaW5hdGVzID0gdGhpcy5fem9vbWVkKCkgYXMgbnVtYmVyW11bXTtcblxuICAgICAgICBjb25zdCBbY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aF0gPVxuICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZUNhbnZhc0RpbWVuc2lvbnNGb3JQb2x5Z29uKHBpeGVsQ29vcmRpbmF0ZXMpO1xuXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuX2NyZWF0ZUNhbnZhcygpO1xuICAgICAgICB0aGlzLl9jaGFuZ2VDYW52YXNTaXplcyhjYW52YXMsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpO1xuXG4gICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIikgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpIGFzIENvbmZpZztcblxuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPVxuICAgICAgICAgIFwic3Ryb2tlQ29sb3JcIiBpbiBjb25maWcgPyAoY29uZmlnPy5zdHJva2VDb2xvciBhcyBzdHJpbmcpIDogXCIjMDAwMEZGXCI7XG4gICAgICAgIGN0eC5saW5lV2lkdGggPVxuICAgICAgICAgIFwic3Ryb2tlV2lkdGhcIiBpbiBjb25maWcgPyAoY29uZmlnLnN0cm9rZVdpZHRoIGFzIG51bWJlcikgOiAyO1xuICAgICAgICBjdHguZmlsbFN0eWxlID1cbiAgICAgICAgICBcImZpbGxDb2xvclwiIGluIGNvbmZpZyA/IChjb25maWcuZmlsbENvbG9yIGFzIHN0cmluZykgOiBcIiM3ZGY5ZmYzM1wiO1xuXG4gICAgICAgIHRoaXMuX2RyYXdQb2x5Z29uKHBpeGVsQ29vcmRpbmF0ZXMsIGN0eCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl93aXRob3V0Wm9vbSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy56b29tVG9Cb3VuZHMpIHtcbiAgICAgICAgLy9yZWN0YW5nbGVcbiAgICAgICAgaWYgKCF0aGlzLmdlb09iamVjdCB8fCAhdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpIHJldHVybjtcbiAgICAgICAgaWYgKCEoXCJnZXRQaXhlbEdlb21ldHJ5XCIgaW4gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHBpeGVsQ29vcmRpbmF0ZXMgPSB0aGlzLl96b29tZWQoKSBhcyBudW1iZXJbXVtdO1xuICAgICAgICBjb25zdCBjYW52YXNIZWlnaHQgPSBNYXRoLnJvdW5kKE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdCgpKSksXG4gICAgICAgICAgY2FudmFzV2lkdGggPSBNYXRoLnJvdW5kKE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdCgpKSk7XG5cbiAgICAgICAgY29uc3QgY2FudmFzID0gdGhpcy5fY3JlYXRlQ2FudmFzKCk7XG4gICAgICAgIHRoaXMuX2NoYW5nZUNhbnZhc1NpemVzKGNhbnZhcywgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG5cbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5nZW9PYmplY3Qub3B0aW9ucy5nZXRBbGwoKSBhcyBDb25maWc7XG5cbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID1cbiAgICAgICAgICBcInN0cm9rZUNvbG9yXCIgaW4gY29uZmlnID8gKGNvbmZpZz8uc3Ryb2tlQ29sb3IgYXMgc3RyaW5nKSA6IFwiIzAwMDBGRlwiO1xuICAgICAgICBjdHgubGluZVdpZHRoID1cbiAgICAgICAgICBcInN0cm9rZVdpZHRoXCIgaW4gY29uZmlnID8gKGNvbmZpZy5zdHJva2VXaWR0aCBhcyBudW1iZXIpIDogMjtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9XG4gICAgICAgICAgXCJmaWxsQ29sb3JcIiBpbiBjb25maWcgPyAoY29uZmlnLmZpbGxDb2xvciBhcyBzdHJpbmcpIDogXCIjN2RmOWZmMzNcIjtcblxuICAgICAgICBjb25zb2xlLmxvZyhwaXhlbENvb3JkaW5hdGVzKTtcbiAgICAgICAgdGhpcy5fZHJhd1JlY3RhbmdsZShwaXhlbENvb3JkaW5hdGVzLCBjdHgsIGNvbmZpZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIShcImdldFBpeGVsR2VvbWV0cnlcIiBpbiB0aGlzLmdlb09iamVjdC5nZW9tZXRyeSkpIHJldHVybjtcblxuICAgICAgICBjb25zdCBwaXhlbEJvdW5kcyA9IHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5XG4gICAgICAgICAgLmdldFBpeGVsR2VvbWV0cnkoKVxuICAgICAgICAgIC5nZXRCb3VuZHMoKSBhcyBudW1iZXJbXVtdO1xuXG4gICAgICAgIGNvbnN0IGRlbHRhWCA9IHRoaXMuX2NhbGN1bGF0ZURlbHRhWChwaXhlbEJvdW5kcyk7XG4gICAgICAgIGNvbnN0IGRlbHRhWSA9IHRoaXMuX2NhbGN1bGF0ZURlbHRhWShwaXhlbEJvdW5kcyk7XG5cbiAgICAgICAgY29uc3QgY2FudmFzID0gdGhpcy5fY3JlYXRlQ2FudmFzKCk7XG5cbiAgICAgICAgY29uc3QgcGl4ZWxDb29yZGluYXRlcyA9IChcbiAgICAgICAgICB0aGlzLmdlb09iamVjdC5nZW9tZXRyeT8uZ2V0UGl4ZWxHZW9tZXRyeSgpIGFzIElQaXhlbFJlY3RhbmdsZUdlb21ldHJ5XG4gICAgICAgIClcbiAgICAgICAgICAuZ2V0Q29vcmRpbmF0ZXMoKVxuICAgICAgICAgIC5tYXAoKHBvaW50KSA9PiBbXG4gICAgICAgICAgICBwb2ludFswXSAtIGRlbHRhWCArIHRoaXMucGFkZGluZyxcbiAgICAgICAgICAgIHBvaW50WzFdIC0gZGVsdGFZICsgdGhpcy5wYWRkaW5nLFxuICAgICAgICAgIF0pO1xuXG4gICAgICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IE1hdGgucm91bmQoXG4gICAgICAgICAgICBNYXRoLm1heCguLi5waXhlbENvb3JkaW5hdGVzLmZsYXRNYXAoKGMpID0+IGNbMV0pKSxcbiAgICAgICAgICApLFxuICAgICAgICAgIGNhbnZhc1dpZHRoID0gTWF0aC5yb3VuZChcbiAgICAgICAgICAgIE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdE1hcCgoYykgPT4gY1swXSkpLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5fY2hhbmdlQ2FudmFzU2l6ZXMoY2FudmFzLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcblxuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpIGFzIENvbmZpZztcblxuICAgICAgICBjb25zb2xlLmxvZyhjb25maWcpO1xuICAgICAgICBjb25zdCBzdHJva2VTdHlsZSA9XG4gICAgICAgICAgdGhpcy5fY2FsY3VsYXRlU3R5bGUoY29uZmlnLCBcInN0cm9rZUNvbG9yXCIsIFwic3Ryb2tlT3BhY2l0eVwiKSB8fFxuICAgICAgICAgIFwicmdiYSgwLDAsMjU1LDAuMSlcIjtcblxuICAgICAgICBjb25zb2xlLmxvZyhcInN0cm9rZVN0eWxlOiBcIiwgc3Ryb2tlU3R5bGUpO1xuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBzdHJva2VTdHlsZTtcbiAgICAgICAgY3R4LmxpbmVXaWR0aCA9XG4gICAgICAgICAgXCJzdHJva2VXaWR0aFwiIGluIGNvbmZpZyA/IChjb25maWcuc3Ryb2tlV2lkdGggYXMgbnVtYmVyKSA6IDI7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPVxuICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZVN0eWxlKGNvbmZpZywgXCJmaWxsQ29sb3JcIiwgXCJmaWxsT3BhY2l0eVwiKSB8fFxuICAgICAgICAgIFwiIzdkZjlmZjMzXCI7XG5cbiAgICAgICAgdGhpcy5fZHJhd1JlY3RhbmdsZShwaXhlbENvb3JkaW5hdGVzLCBjdHgsIGNvbmZpZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3dpdGhvdXRab29tKCkge1xuICAgIGlmICghdGhpcy5nZW9PYmplY3QgfHwgIXRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSByZXR1cm47XG4gICAgaWYgKCEoXCJnZXRQaXhlbEdlb21ldHJ5XCIgaW4gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpKSByZXR1cm47XG5cbiAgICBjb25zdCBwaXhlbEJvdW5kcyA9IHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5XG4gICAgICAuZ2V0UGl4ZWxHZW9tZXRyeSgpXG4gICAgICAuZ2V0Qm91bmRzKCkgYXMgbnVtYmVyW11bXTtcblxuICAgIGNvbnN0IGRlbHRhWCA9IHRoaXMuX2NhbGN1bGF0ZURlbHRhWChwaXhlbEJvdW5kcyk7XG4gICAgY29uc3QgZGVsdGFZID0gdGhpcy5fY2FsY3VsYXRlRGVsdGFZKHBpeGVsQm91bmRzKTtcblxuICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuX2NyZWF0ZUNhbnZhcygpO1xuXG4gICAgY29uc3QgcGl4ZWxDb29yZGluYXRlcyA9IChcbiAgICAgIHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5Py5nZXRQaXhlbEdlb21ldHJ5KCkgYXMgSVBpeGVsUG9seWdvbkdlb21ldHJ5XG4gICAgKVxuICAgICAgLmdldENvb3JkaW5hdGVzKClbMF1cbiAgICAgIC5tYXAoKHBvaW50KSA9PiBbXG4gICAgICAgIHBvaW50WzBdIC0gZGVsdGFYICsgdGhpcy5wYWRkaW5nLFxuICAgICAgICBwb2ludFsxXSAtIGRlbHRhWSArIHRoaXMucGFkZGluZyxcbiAgICAgIF0pO1xuXG4gICAgY29uc3QgW2NhbnZhc0hlaWdodCwgY2FudmFzV2lkdGhdID1cbiAgICAgIHRoaXMuX2NhbGN1bGF0ZUNhbnZhc0RpbWVuc2lvbnNGb3JQb2x5Z29uKHBpeGVsQ29vcmRpbmF0ZXMpO1xuXG4gICAgdGhpcy5fY2hhbmdlQ2FudmFzU2l6ZXMoY2FudmFzLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcblxuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIikgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuXG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5nZW9PYmplY3Qub3B0aW9ucy5nZXRBbGwoKTtcblxuICAgIGN0eC5zdHJva2VTdHlsZSA9XG4gICAgICBcInN0cm9rZUNvbG9yXCIgaW4gY29uZmlnID8gKGNvbmZpZz8uc3Ryb2tlQ29sb3IgYXMgc3RyaW5nKSA6IFwiIzAwMDBGRlwiO1xuICAgIGN0eC5saW5lV2lkdGggPVxuICAgICAgXCJzdHJva2VXaWR0aFwiIGluIGNvbmZpZyA/IChjb25maWcuc3Ryb2tlV2lkdGggYXMgbnVtYmVyKSA6IDI7XG4gICAgY3R4LmZpbGxTdHlsZSA9XG4gICAgICBcImZpbGxDb2xvclwiIGluIGNvbmZpZyA/IChjb25maWcuZmlsbENvbG9yIGFzIHN0cmluZykgOiBcIiM3ZGY5ZmYzM1wiO1xuXG4gICAgdGhpcy5fZHJhd1BvbHlnb24ocGl4ZWxDb29yZGluYXRlcywgY3R4KTtcbiAgfVxuXG4gIF9kcmF3UmVjdGFuZ2xlKFxuICAgIHBpeGVsQ29vcmRpbmF0ZXM6IG51bWJlcltdW10sXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gICAgY29uZmlnOiBDb25maWcsXG4gICkge1xuICAgIGNvbnN0IHN0YXJ0UG9pbnQgPSBbcGl4ZWxDb29yZGluYXRlc1swXVswXSwgcGl4ZWxDb29yZGluYXRlc1sxXVsxXV0sXG4gICAgICB3aWR0aCA9IHBpeGVsQ29vcmRpbmF0ZXNbMV1bMF0gLSBwaXhlbENvb3JkaW5hdGVzWzBdWzBdLFxuICAgICAgaGVpZ2h0ID0gcGl4ZWxDb29yZGluYXRlc1swXVsxXSAtIHBpeGVsQ29vcmRpbmF0ZXNbMV1bMV07XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5yb3VuZFJlY3QoXG4gICAgICBzdGFydFBvaW50WzBdLFxuICAgICAgc3RhcnRQb2ludFsxXSxcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgICAgY29uZmlnPy5ib3JkZXJSYWRpdXMgfHwgMCxcbiAgICApO1xuXG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5maWxsKCk7XG4gIH1cblxuICBfZHJhd1BvbHlnb24ocGl4ZWxDb29yZGluYXRlczogbnVtYmVyW11bXSwgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhwaXhlbENvb3JkaW5hdGVzWzBdWzBdLCBwaXhlbENvb3JkaW5hdGVzWzBdWzFdKTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGl4ZWxDb29yZGluYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY3R4LmxpbmVUbyhwaXhlbENvb3JkaW5hdGVzW2ldWzBdLCBwaXhlbENvb3JkaW5hdGVzW2ldWzFdKTtcbiAgICB9XG5cbiAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5maWxsKCk7XG4gIH1cblxuICBfem9vbWVkKCkge1xuICAgIGlmICghdGhpcy5nZW9PYmplY3QgfHwgIXRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSByZXR1cm47XG4gICAgaWYgKCEoXCJnZXRQaXhlbEdlb21ldHJ5XCIgaW4gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpKSByZXR1cm47XG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkuZ2V0Qm91bmRzKCkgYXMgbnVtYmVyW11bXTtcbiAgICBjb25zdCB0eXBlID0gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkuZ2V0VHlwZSgpIGFzIEF2YWlsYWJsZUdlb09iamVjdHNUeXBlO1xuICAgIGNvbnN0IFttYXAsIG1hcENvbnRhaW5lcl0gPSB0aGlzLl9jcmVhdGVNYXAoYm91bmRzLCB0eXBlKSBhcyBbXG4gICAgICBNYXAsXG4gICAgICBIVE1MRGl2RWxlbWVudCxcbiAgICBdO1xuICAgIGNvbnN0IG9iamVjdCA9IG1hcC5nZW9PYmplY3RzXG4gICAgICAuZ2V0SXRlcmF0b3IoKVxuICAgICAgLmdldE5leHQoKSBhcyB0eXBlb2YgdGhpcy5nZW9PYmplY3Q7XG4gICAgY29uc3QgcGl4ZWxCb3VuZHMgPSBvYmplY3QuZ2VvbWV0cnlcbiAgICAgID8uZ2V0UGl4ZWxHZW9tZXRyeSgpXG4gICAgICAuZ2V0Qm91bmRzKCkgYXMgbnVtYmVyW11bXTtcblxuICAgIGNvbnN0IGRlbHRhWCA9IHRoaXMuX2NhbGN1bGF0ZURlbHRhWChwaXhlbEJvdW5kcyk7XG4gICAgY29uc3QgZGVsdGFZID0gdGhpcy5fY2FsY3VsYXRlRGVsdGFZKHBpeGVsQm91bmRzKTtcblxuICAgIGlmICh0eXBlID09PSBcIlBvbHlnb25cIikge1xuICAgICAgcmV0dXJuIChvYmplY3QuZ2VvbWV0cnk/LmdldFBpeGVsR2VvbWV0cnkoKSBhcyBJUGl4ZWxQb2x5Z29uR2VvbWV0cnkpXG4gICAgICAgIC5nZXRDb29yZGluYXRlcygpWzBdXG4gICAgICAgIC5tYXAoKHBvaW50KSA9PiBbXG4gICAgICAgICAgcG9pbnRbMF0gLSBkZWx0YVggKyB0aGlzLnBhZGRpbmcsXG4gICAgICAgICAgcG9pbnRbMV0gLSBkZWx0YVkgKyB0aGlzLnBhZGRpbmcsXG4gICAgICAgIF0pO1xuICAgIH1cbiAgICByZXR1cm4gKG9iamVjdC5nZW9tZXRyeT8uZ2V0UGl4ZWxHZW9tZXRyeSgpIGFzIElQaXhlbFJlY3RhbmdsZUdlb21ldHJ5KVxuICAgICAgLmdldENvb3JkaW5hdGVzKClcbiAgICAgIC5tYXAoKHBvaW50KSA9PiBbXG4gICAgICAgIHBvaW50WzBdIC0gZGVsdGFYICsgdGhpcy5wYWRkaW5nLFxuICAgICAgICBwb2ludFsxXSAtIGRlbHRhWSArIHRoaXMucGFkZGluZyxcbiAgICAgIF0pO1xuICB9XG5cbiAgX2NhbGN1bGF0ZVN0eWxlID0gKFxuICAgIGNvbmZpZzogQ29uZmlnLFxuICAgIGNvbG9yUHJvcGVydHk6IFwiZmlsbENvbG9yXCIgfCBcInN0cm9rZUNvbG9yXCIsXG4gICAgb3BhY2l0eVByb3BlcnR5OiBcImZpbGxPcGFjaXR5XCIgfCBcInN0cm9rZU9wYWNpdHlcIixcbiAgKSA9PiB7XG4gICAgbGV0IHJldHVyblZhbHVlID0gXCJcIjtcbiAgICBpZiAoY29sb3JQcm9wZXJ0eSBpbiBjb25maWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwic3Ryb2tlXCIpO1xuICAgICAgcmV0dXJuVmFsdWUgPSBjb25maWdbY29sb3JQcm9wZXJ0eV07XG4gICAgICBpZiAob3BhY2l0eVByb3BlcnR5IGluIGNvbmZpZykge1xuICAgICAgICBpZiAocmV0dXJuVmFsdWUubGVuZ3RoID09PSA5KSB7XG4gICAgICAgICAgY29uc3QgaGV4ID0gY29uZmlnW2NvbG9yUHJvcGVydHldO1xuICAgICAgICAgIGNvbnN0IG9wYWNpdHkgPVxuICAgICAgICAgICAgKHBhcnNlSW50KHJldHVyblZhbHVlLnNsaWNlKDcpLCAxNikgLyAyNTUpICpcbiAgICAgICAgICAgIGNvbmZpZ1tvcGFjaXR5UHJvcGVydHldO1xuXG4gICAgICAgICAgY29uc3QgciA9IHBhcnNlSW50KGhleC5zbGljZSgxLCAzKSwgMTYpLFxuICAgICAgICAgICAgZyA9IHBhcnNlSW50KGhleC5zbGljZSgzLCA1KSwgMTYpLFxuICAgICAgICAgICAgYiA9IHBhcnNlSW50KGhleC5zbGljZSg1LCA3KSwgMTYpO1xuICAgICAgICAgIHJldHVybiBgcmdiYSgke3J9LCR7Z30sJHtifSwke29wYWNpdHl9KWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGNvbmZpZ1tjb2xvclByb3BlcnR5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH07XG5cbiAgX2NoYW5nZUNhbnZhc1NpemVzKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XG4gICAgY2FudmFzLndpZHRoID0gd2lkdGggKyB0aGlzLnBhZGRpbmc7XG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCArIHRoaXMucGFkZGluZztcbiAgfVxuXG4gIF9jYWxjdWxhdGVEZWx0YVgocGl4ZWxCb3VuZHM6IG51bWJlcltdW10pIHtcbiAgICByZXR1cm4gTWF0aC5taW4ocGl4ZWxCb3VuZHNbMF1bMF0sIHBpeGVsQm91bmRzWzFdWzBdKTtcbiAgfVxuXG4gIF9jYWxjdWxhdGVEZWx0YVkocGl4ZWxCb3VuZHM6IG51bWJlcltdW10pIHtcbiAgICByZXR1cm4gTWF0aC5taW4ocGl4ZWxCb3VuZHNbMF1bMV0sIHBpeGVsQm91bmRzWzFdWzFdKTtcbiAgfVxuXG4gIF9jYWxjdWxhdGVDYW52YXNEaW1lbnNpb25zRm9yUG9seWdvbihcbiAgICBwaXhlbENvb3JkaW5hdGVzOiBudW1iZXJbXVtdLFxuICApOiBbaGVpZ2h0OiBudW1iZXIsIHdpZHRoOiBudW1iZXJdIHtcbiAgICByZXR1cm4gW1xuICAgICAgTWF0aC5yb3VuZChNYXRoLm1heCguLi5waXhlbENvb3JkaW5hdGVzLmZsYXRNYXAoKGMpID0+IGNbMV0pKSksXG4gICAgICBNYXRoLnJvdW5kKE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdE1hcCgoYykgPT4gY1swXSkpKSxcbiAgICBdO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7O0FBbUJBO0FBQ0EsTUFBTUEsT0FBTyxDQUFDO0VBRVpDLFNBQVMsR0FBVyxTQUFTLEdBQUdDLElBQUksQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQ0MsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztFQUMxRUMsTUFBTSxHQUFXLE1BQU0sR0FBR0osSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0VBQ3BFRSxTQUFTLEdBQVksS0FBSztFQUMxQkMsYUFBYSxHQUFZLEtBQUs7RUFDOUJDLFFBQVEsR0FBVyxFQUFFO0VBRXJCLElBQUlDLFNBQVNBLENBQUEsRUFBRztJQUNkLE9BQU8sSUFBSSxDQUFDQyxVQUFVO0VBQ3hCO0VBRUEsSUFBSUMsT0FBT0EsQ0FBQSxFQUFHO0lBQ1osT0FBTyxJQUFJLENBQUNILFFBQVE7RUFDdEI7RUFFQSxJQUFJSSxRQUFRQSxDQUFBLEVBQUc7SUFDYixPQUFPLElBQUksQ0FBQ1osU0FBUztFQUN2QjtFQUVBLElBQUlhLEtBQUtBLENBQUEsRUFBRztJQUNWLE9BQU8sSUFBSSxDQUFDUixNQUFNO0VBQ3BCO0VBRUEsSUFBSVMsWUFBWUEsQ0FBQSxFQUFHO0lBQ2pCLE9BQU8sSUFBSSxDQUFDUCxhQUFhO0VBQzNCO0VBRUEsSUFBSVEsUUFBUUEsQ0FBQSxFQUFHO0lBQ2IsT0FBTyxJQUFJLENBQUNULFNBQVM7RUFDdkI7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRVUsV0FBV0EsQ0FDVFAsU0FBb0IsRUFDcEJFLE9BQWUsR0FBRyxFQUFFLEVBQ3BCSSxRQUFp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