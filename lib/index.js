"use strict";

// eslint-disable-next-line @typescript-eslint/no-unused-vars
class Geo2Png {
  _canvasId = "canvas_" + Math.random().toString(36).substring(2, 7);
  _mapId = "map_" + Math.random().toString(36).substring(2, 7);
  _download = false;
  _zoomToBounds = false;
  _padding = 10;
  get geoObject() {
    return this._geoObject;
  }
  get padding() {
    return this._padding;
  }
  get canvasId() {
    return this._canvasId;
  }
  get mapId() {
    return this._mapId;
  }
  get zoomToBounds() {
    return this._zoomToBounds;
  }
  get download() {
    return this._download;
  }
  constructor(geoObject, padding = 10, download = false, zoomToBounds = false) {
    this._geoObject = geoObject;
    this._download = download;
    this._zoomToBounds = zoomToBounds;
    this._padding = padding;
    console.log(geoObject.options.getAll());
  }
  _createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.setAttribute("id", this.canvasId);
    document.body.appendChild(canvas);
    return canvas;
  }
  _createMap(bounds) {
    if (!("ymaps" in window)) return;
    const mapContainer = document.createElement("div");
    mapContainer.setAttribute("id", this.mapId);
    mapContainer.style.width = "500px";
    mapContainer.style.height = "500px";
    document.body.appendChild(mapContainer);
    const map = new window.ymaps.Map(this.mapId, {
      bounds
    }, {
      avoidFractionalZoom: false
    });
    const Polygon = new window.ymaps.Polygon(this.geoObject.geometry?.getCoordinates(), {}, this.geoObject.options.getAll());
    map.geoObjects.add(Polygon);
    return [map, mapContainer];
  }
  createPng() {
    if (!this.geoObject || !this.geoObject.geometry) return;
    console.log(this.geoObject.geometry.getType());
    if (this.geoObject.geometry.getType() === "Polygon") {
      if (this.zoomToBounds) {
        if (!("getPixelGeometry" in this.geoObject.geometry)) return;
        const bounds = this.geoObject.geometry.getBounds();
        const [map, mapContainer] = this._createMap(bounds);
        const object = map.geoObjects.getIterator().getNext();
        const pixelBounds = object.geometry?.getPixelGeometry().getBounds();
        const deltaX = Math.min(pixelBounds[0][0], pixelBounds[1][0]);
        const deltaY = Math.min(pixelBounds[0][1], pixelBounds[1][1]);
        const pixelCoordinates = (object.geometry?.getPixelGeometry()).getCoordinates()[0].map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
        const canvasHeight = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[1]))),
          canvasWidth = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[0])));
        const canvas = this._createCanvas();
        canvas.width = canvasWidth + this.padding;
        canvas.height = canvasHeight + this.padding;
        const ctx = canvas.getContext("2d");
        const config = this.geoObject.options.getAll();
        ctx.strokeStyle = "strokeColor" in config ? config?.strokeColor : "#0000FF";
        ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
        ctx.fillStyle = "fillColor" in config ? config.fillColor : "#7df9ff33";
        ctx.beginPath();
        ctx.moveTo(pixelCoordinates[0][0], pixelCoordinates[0][1]);
        for (let i = 1; i < pixelCoordinates.length; i++) {
          ctx.lineTo(pixelCoordinates[i][0], pixelCoordinates[i][1]);
        }
        ctx.closePath();
        ctx.stroke();
        ctx.fill();

        // console.log(canvas.toDataURL());
      } else {
        this._withoutZoom();
      }
    } else {
      if (!("getPixelGeometry" in this.geoObject.geometry)) return;
      const pixelBounds = this.geoObject.geometry.getPixelGeometry().getBounds();
      const deltaX = Math.min(pixelBounds[0][0], pixelBounds[1][0]);
      const deltaY = Math.min(pixelBounds[0][1], pixelBounds[1][1]);
      const canvas = this._createCanvas();
      const pixelCoordinates = (this.geoObject.geometry?.getPixelGeometry()).getCoordinates().map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
      console.log(pixelCoordinates, deltaX, deltaY);
      const canvasHeight = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[1]))),
        canvasWidth = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[0])));
      canvas.width = canvasWidth + this.padding;
      canvas.height = canvasHeight + this.padding;
      const ctx = canvas.getContext("2d");
      const config = this.geoObject.options.getAll();
      console.log(config);
      const strokeStyle = this._calculateStyle(config, "strokeColor", "strokeOpacity") || "rgba(0,0,255,0.1)";
      console.log("strokeStyle: ", strokeStyle);
      ctx.strokeStyle = strokeStyle;
      ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
      ctx.fillStyle = this._calculateStyle(config, "fillColor", "fillOpacity") || "#7df9ff33";
      console.log(ctx.fillStyle);
      ctx.beginPath();
      ctx.roundRect(pixelCoordinates[0][0], pixelCoordinates[0][1], pixelCoordinates[1][0] - pixelCoordinates[0][0], pixelCoordinates[1][1] - pixelCoordinates[0][1], "borderRadius" in config ? config.borderRadius : 0);
      ctx.stroke();
      ctx.fill();
    }
  }
  _withoutZoom() {
    if (!this.geoObject || !this.geoObject.geometry) return;
    if (!("getPixelGeometry" in this.geoObject.geometry)) return;
    const pixelBounds = this.geoObject.geometry.getPixelGeometry().getBounds();
    const deltaX = Math.min(pixelBounds[0][0], pixelBounds[1][0]);
    const deltaY = Math.min(pixelBounds[0][1], pixelBounds[1][1]);
    const canvas = this._createCanvas();
    const pixelCoordinates = (this.geoObject.geometry?.getPixelGeometry()).getCoordinates()[0].map(point => [point[0] - deltaX + this.padding, point[1] - deltaY + this.padding]);
    const canvasHeight = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[1]))),
      canvasWidth = Math.round(Math.max(...pixelCoordinates.flatMap(c => c[0])));
    canvas.width = canvasWidth + this.padding;
    canvas.height = canvasHeight + this.padding;
    const ctx = canvas.getContext("2d");
    const config = this.geoObject.options.getAll();
    ctx.strokeStyle = "strokeColor" in config ? config?.strokeColor : "#0000FF";
    ctx.lineWidth = "strokeWidth" in config ? config.strokeWidth : 2;
    ctx.fillStyle = "fillColor" in config ? config.fillColor : "#7df9ff33";
    ctx.beginPath();
    ctx.moveTo(pixelCoordinates[0][0], pixelCoordinates[0][1]);
    for (let i = 1; i < pixelCoordinates.length; i++) {
      ctx.lineTo(pixelCoordinates[i][0], pixelCoordinates[i][1]);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.fill();

    // console.log(canvas.toDataURL());

    // document.body.removeChild(canvas);
  }

  _calculateStyle = (config, colorProperty, opacityProperty) => {
    let returnValue = "";
    if (colorProperty in config) {
      console.log("stroke");
      returnValue = config[colorProperty];
      if ("strokeOpacity" in config) {
        if (returnValue.length === 9) {
          const hex = config[colorProperty];
          const opacity = parseInt(returnValue.slice(7), 16) / 255 * config[opacityProperty];
          const r = parseInt(hex.slice(1, 3), 16),
            g = parseInt(hex.slice(3, 5), 16),
            b = parseInt(hex.slice(5, 7), 16);
          return `rgba(${r},${g},${b},${opacity})`;
        } else {
          return config[colorProperty];
        }
      }
      return returnValue;
    }
    return returnValue;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHZW8yUG5nIiwiX2NhbnZhc0lkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiX21hcElkIiwiX2Rvd25sb2FkIiwiX3pvb21Ub0JvdW5kcyIsIl9wYWRkaW5nIiwiZ2VvT2JqZWN0IiwiX2dlb09iamVjdCIsInBhZGRpbmciLCJjYW52YXNJZCIsIm1hcElkIiwiem9vbVRvQm91bmRzIiwiZG93bmxvYWQiLCJjb25zdHJ1Y3RvciIsImNvbnNvbGUiLCJsb2ciLCJvcHRpb25zIiwiZ2V0QWxsIiwiX2NyZWF0ZUNhbnZhcyIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIl9jcmVhdGVNYXAiLCJib3VuZHMiLCJ3aW5kb3ciLCJtYXBDb250YWluZXIiLCJzdHlsZSIsIndpZHRoIiwiaGVpZ2h0IiwibWFwIiwieW1hcHMiLCJNYXAiLCJhdm9pZEZyYWN0aW9uYWxab29tIiwiUG9seWdvbiIsImdlb21ldHJ5IiwiZ2V0Q29vcmRpbmF0ZXMiLCJnZW9PYmplY3RzIiwiYWRkIiwiY3JlYXRlUG5nIiwiZ2V0VHlwZSIsImdldEJvdW5kcyIsIm9iamVjdCIsImdldEl0ZXJhdG9yIiwiZ2V0TmV4dCIsInBpeGVsQm91bmRzIiwiZ2V0UGl4ZWxHZW9tZXRyeSIsImRlbHRhWCIsIm1pbiIsImRlbHRhWSIsInBpeGVsQ29vcmRpbmF0ZXMiLCJwb2ludCIsImNhbnZhc0hlaWdodCIsInJvdW5kIiwibWF4IiwiZmxhdE1hcCIsImMiLCJjYW52YXNXaWR0aCIsImN0eCIsImdldENvbnRleHQiLCJjb25maWciLCJzdHJva2VTdHlsZSIsInN0cm9rZUNvbG9yIiwibGluZVdpZHRoIiwic3Ryb2tlV2lkdGgiLCJmaWxsU3R5bGUiLCJmaWxsQ29sb3IiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJpIiwibGVuZ3RoIiwibGluZVRvIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwiZmlsbCIsIl93aXRob3V0Wm9vbSIsIl9jYWxjdWxhdGVTdHlsZSIsInJvdW5kUmVjdCIsImJvcmRlclJhZGl1cyIsImNvbG9yUHJvcGVydHkiLCJvcGFjaXR5UHJvcGVydHkiLCJyZXR1cm5WYWx1ZSIsImhleCIsIm9wYWNpdHkiLCJwYXJzZUludCIsInNsaWNlIiwiciIsImciLCJiIl0sInNvdXJjZXMiOlsiLi4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgR2VvT2JqZWN0LFxuICBJUGl4ZWxQb2x5Z29uR2VvbWV0cnksXG4gIElQaXhlbFJlY3RhbmdsZUdlb21ldHJ5LFxuICBJUG9seWdvbkdlb21ldHJ5LFxuICBNYXAsXG59IGZyb20gXCJ5YW5kZXgtbWFwc1wiO1xuaW1wb3J0IHsgUG9seWdvbiB9IGZyb20gXCJ5YW5kZXgtbWFwc1wiO1xuXG5pbnRlcmZhY2UgQ29uZmlnIHtcbiAgZmlsbENvbG9yOiBzdHJpbmc7XG4gIGZpbGxPcGFjaXR5OiBudW1iZXI7XG4gIHN0cm9rZUNvbG9yOiBzdHJpbmc7XG4gIHN0cm9rZU9wYWNpdHk6IG51bWJlcjtcbiAgc3Ryb2tlV2lkdGg6IG51bWJlcjtcbiAgYm9yZGVyUmFkaXVzOiBudW1iZXI7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbmNsYXNzIEdlbzJQbmcge1xuICBfZ2VvT2JqZWN0ITogR2VvT2JqZWN0O1xuICBfY2FudmFzSWQ6IHN0cmluZyA9IFwiY2FudmFzX1wiICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDcpO1xuICBfbWFwSWQ6IHN0cmluZyA9IFwibWFwX1wiICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDcpO1xuICBfZG93bmxvYWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgX3pvb21Ub0JvdW5kczogYm9vbGVhbiA9IGZhbHNlO1xuICBfcGFkZGluZzogbnVtYmVyID0gMTA7XG5cbiAgZ2V0IGdlb09iamVjdCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZ2VvT2JqZWN0O1xuICB9XG5cbiAgZ2V0IHBhZGRpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhZGRpbmc7XG4gIH1cblxuICBnZXQgY2FudmFzSWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NhbnZhc0lkO1xuICB9XG5cbiAgZ2V0IG1hcElkKCkge1xuICAgIHJldHVybiB0aGlzLl9tYXBJZDtcbiAgfVxuXG4gIGdldCB6b29tVG9Cb3VuZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3pvb21Ub0JvdW5kcztcbiAgfVxuXG4gIGdldCBkb3dubG9hZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZG93bmxvYWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBnZW9PYmplY3Q6IEdlb09iamVjdCxcbiAgICBwYWRkaW5nOiBudW1iZXIgPSAxMCxcbiAgICBkb3dubG9hZDogYm9vbGVhbiA9IGZhbHNlLFxuICAgIHpvb21Ub0JvdW5kczogYm9vbGVhbiA9IGZhbHNlLFxuICApIHtcbiAgICB0aGlzLl9nZW9PYmplY3QgPSBnZW9PYmplY3Q7XG4gICAgdGhpcy5fZG93bmxvYWQgPSBkb3dubG9hZDtcbiAgICB0aGlzLl96b29tVG9Cb3VuZHMgPSB6b29tVG9Cb3VuZHM7XG4gICAgdGhpcy5fcGFkZGluZyA9IHBhZGRpbmc7XG4gICAgY29uc29sZS5sb2coZ2VvT2JqZWN0Lm9wdGlvbnMuZ2V0QWxsKCkpO1xuICB9XG5cbiAgX2NyZWF0ZUNhbnZhcygpOiBIVE1MQ2FudmFzRWxlbWVudCB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMuc2V0QXR0cmlidXRlKFwiaWRcIiwgdGhpcy5jYW52YXNJZCk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xuICAgIHJldHVybiBjYW52YXM7XG4gIH1cblxuICBfY3JlYXRlTWFwKGJvdW5kczogbnVtYmVyW11bXSk6IFtNYXAsIEhUTUxEaXZFbGVtZW50XSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCEoXCJ5bWFwc1wiIGluIHdpbmRvdykpIHJldHVybjtcbiAgICBjb25zdCBtYXBDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG1hcENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aGlzLm1hcElkKTtcbiAgICBtYXBDb250YWluZXIuc3R5bGUud2lkdGggPSBcIjUwMHB4XCI7XG4gICAgbWFwQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IFwiNTAwcHhcIjtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1hcENvbnRhaW5lcik7XG4gICAgY29uc3QgbWFwID0gbmV3IHdpbmRvdy55bWFwcy5NYXAoXG4gICAgICB0aGlzLm1hcElkLFxuICAgICAge1xuICAgICAgICBib3VuZHMsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBhdm9pZEZyYWN0aW9uYWxab29tOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBjb25zdCBQb2x5Z29uID0gbmV3IHdpbmRvdy55bWFwcy5Qb2x5Z29uKFxuICAgICAgKHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5IGFzIElQb2x5Z29uR2VvbWV0cnkpPy5nZXRDb29yZGluYXRlcygpLFxuICAgICAge30sXG4gICAgICB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpLFxuICAgICk7XG4gICAgbWFwLmdlb09iamVjdHMuYWRkKFBvbHlnb24pO1xuICAgIHJldHVybiBbbWFwLCBtYXBDb250YWluZXJdO1xuICB9XG5cbiAgY3JlYXRlUG5nKCkge1xuICAgIGlmICghdGhpcy5nZW9PYmplY3QgfHwgIXRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSByZXR1cm47XG4gICAgY29uc29sZS5sb2codGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkuZ2V0VHlwZSgpKTtcbiAgICBpZiAodGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkuZ2V0VHlwZSgpID09PSBcIlBvbHlnb25cIikge1xuICAgICAgaWYgKHRoaXMuem9vbVRvQm91bmRzKSB7XG4gICAgICAgIGlmICghKFwiZ2V0UGl4ZWxHZW9tZXRyeVwiIGluIHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdlb09iamVjdC5nZW9tZXRyeS5nZXRCb3VuZHMoKSBhcyBudW1iZXJbXVtdO1xuXG4gICAgICAgIGNvbnN0IFttYXAsIG1hcENvbnRhaW5lcl0gPSB0aGlzLl9jcmVhdGVNYXAoYm91bmRzKSBhcyBbXG4gICAgICAgICAgTWFwLFxuICAgICAgICAgIEhUTUxEaXZFbGVtZW50LFxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBtYXAuZ2VvT2JqZWN0cy5nZXRJdGVyYXRvcigpLmdldE5leHQoKSBhcyBQb2x5Z29uO1xuXG4gICAgICAgIGNvbnN0IHBpeGVsQm91bmRzID0gb2JqZWN0Lmdlb21ldHJ5XG4gICAgICAgICAgPy5nZXRQaXhlbEdlb21ldHJ5KClcbiAgICAgICAgICAuZ2V0Qm91bmRzKCkgYXMgbnVtYmVyW11bXTtcblxuICAgICAgICBjb25zdCBkZWx0YVggPSBNYXRoLm1pbihwaXhlbEJvdW5kc1swXVswXSwgcGl4ZWxCb3VuZHNbMV1bMF0pO1xuICAgICAgICBjb25zdCBkZWx0YVkgPSBNYXRoLm1pbihwaXhlbEJvdW5kc1swXVsxXSwgcGl4ZWxCb3VuZHNbMV1bMV0pO1xuICAgICAgICBjb25zdCBwaXhlbENvb3JkaW5hdGVzID0gKFxuICAgICAgICAgIG9iamVjdC5nZW9tZXRyeT8uZ2V0UGl4ZWxHZW9tZXRyeSgpIGFzIElQaXhlbFBvbHlnb25HZW9tZXRyeVxuICAgICAgICApXG4gICAgICAgICAgLmdldENvb3JkaW5hdGVzKClbMF1cbiAgICAgICAgICAubWFwKChwb2ludCkgPT4gW1xuICAgICAgICAgICAgcG9pbnRbMF0gLSBkZWx0YVggKyB0aGlzLnBhZGRpbmcsXG4gICAgICAgICAgICBwb2ludFsxXSAtIGRlbHRhWSArIHRoaXMucGFkZGluZyxcbiAgICAgICAgICBdKTtcblxuICAgICAgICBjb25zdCBjYW52YXNIZWlnaHQgPSBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgTWF0aC5tYXgoLi4ucGl4ZWxDb29yZGluYXRlcy5mbGF0TWFwKChjKSA9PiBjWzFdKSksXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjYW52YXNXaWR0aCA9IE1hdGgucm91bmQoXG4gICAgICAgICAgICBNYXRoLm1heCguLi5waXhlbENvb3JkaW5hdGVzLmZsYXRNYXAoKGMpID0+IGNbMF0pKSxcbiAgICAgICAgICApO1xuICAgICAgICBjb25zdCBjYW52YXMgPSB0aGlzLl9jcmVhdGVDYW52YXMoKTtcblxuICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXNXaWR0aCArIHRoaXMucGFkZGluZztcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNhbnZhc0hlaWdodCArIHRoaXMucGFkZGluZztcbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5nZW9PYmplY3Qub3B0aW9ucy5nZXRBbGwoKTtcblxuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPVxuICAgICAgICAgIFwic3Ryb2tlQ29sb3JcIiBpbiBjb25maWcgPyAoY29uZmlnPy5zdHJva2VDb2xvciBhcyBzdHJpbmcpIDogXCIjMDAwMEZGXCI7XG4gICAgICAgIGN0eC5saW5lV2lkdGggPVxuICAgICAgICAgIFwic3Ryb2tlV2lkdGhcIiBpbiBjb25maWcgPyAoY29uZmlnLnN0cm9rZVdpZHRoIGFzIG51bWJlcikgOiAyO1xuICAgICAgICBjdHguZmlsbFN0eWxlID1cbiAgICAgICAgICBcImZpbGxDb2xvclwiIGluIGNvbmZpZyA/IChjb25maWcuZmlsbENvbG9yIGFzIHN0cmluZykgOiBcIiM3ZGY5ZmYzM1wiO1xuXG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4Lm1vdmVUbyhwaXhlbENvb3JkaW5hdGVzWzBdWzBdLCBwaXhlbENvb3JkaW5hdGVzWzBdWzFdKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBpeGVsQ29vcmRpbmF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjdHgubGluZVRvKHBpeGVsQ29vcmRpbmF0ZXNbaV1bMF0sIHBpeGVsQ29vcmRpbmF0ZXNbaV1bMV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coY2FudmFzLnRvRGF0YVVSTCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3dpdGhvdXRab29tKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghKFwiZ2V0UGl4ZWxHZW9tZXRyeVwiIGluIHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5KSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBwaXhlbEJvdW5kcyA9IHRoaXMuZ2VvT2JqZWN0Lmdlb21ldHJ5XG4gICAgICAgIC5nZXRQaXhlbEdlb21ldHJ5KClcbiAgICAgICAgLmdldEJvdW5kcygpIGFzIG51bWJlcltdW107XG5cbiAgICAgIGNvbnN0IGRlbHRhWCA9IE1hdGgubWluKHBpeGVsQm91bmRzWzBdWzBdLCBwaXhlbEJvdW5kc1sxXVswXSk7XG4gICAgICBjb25zdCBkZWx0YVkgPSBNYXRoLm1pbihwaXhlbEJvdW5kc1swXVsxXSwgcGl4ZWxCb3VuZHNbMV1bMV0pO1xuXG4gICAgICBjb25zdCBjYW52YXMgPSB0aGlzLl9jcmVhdGVDYW52YXMoKTtcblxuICAgICAgY29uc3QgcGl4ZWxDb29yZGluYXRlcyA9IChcbiAgICAgICAgdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnk/LmdldFBpeGVsR2VvbWV0cnkoKSBhcyBJUGl4ZWxSZWN0YW5nbGVHZW9tZXRyeVxuICAgICAgKVxuICAgICAgICAuZ2V0Q29vcmRpbmF0ZXMoKVxuICAgICAgICAubWFwKChwb2ludCkgPT4gW1xuICAgICAgICAgIHBvaW50WzBdIC0gZGVsdGFYICsgdGhpcy5wYWRkaW5nLFxuICAgICAgICAgIHBvaW50WzFdIC0gZGVsdGFZICsgdGhpcy5wYWRkaW5nLFxuICAgICAgICBdKTtcblxuICAgICAgY29uc29sZS5sb2cocGl4ZWxDb29yZGluYXRlcywgZGVsdGFYLCBkZWx0YVkpO1xuICAgICAgY29uc3QgY2FudmFzSGVpZ2h0ID0gTWF0aC5yb3VuZChcbiAgICAgICAgICBNYXRoLm1heCguLi5waXhlbENvb3JkaW5hdGVzLmZsYXRNYXAoKGMpID0+IGNbMV0pKSxcbiAgICAgICAgKSxcbiAgICAgICAgY2FudmFzV2lkdGggPSBNYXRoLnJvdW5kKFxuICAgICAgICAgIE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdE1hcCgoYykgPT4gY1swXSkpLFxuICAgICAgICApO1xuXG4gICAgICBjYW52YXMud2lkdGggPSBjYW52YXNXaWR0aCArIHRoaXMucGFkZGluZztcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBjYW52YXNIZWlnaHQgKyB0aGlzLnBhZGRpbmc7XG4gICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5nZW9PYmplY3Qub3B0aW9ucy5nZXRBbGwoKTtcblxuICAgICAgY29uc29sZS5sb2coY29uZmlnKTtcbiAgICAgIGNvbnN0IHN0cm9rZVN0eWxlID1cbiAgICAgICAgdGhpcy5fY2FsY3VsYXRlU3R5bGUoY29uZmlnLCBcInN0cm9rZUNvbG9yXCIsIFwic3Ryb2tlT3BhY2l0eVwiKSB8fFxuICAgICAgICBcInJnYmEoMCwwLDI1NSwwLjEpXCI7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwic3Ryb2tlU3R5bGU6IFwiLCBzdHJva2VTdHlsZSk7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBzdHJva2VTdHlsZTtcbiAgICAgIGN0eC5saW5lV2lkdGggPVxuICAgICAgICBcInN0cm9rZVdpZHRoXCIgaW4gY29uZmlnID8gKGNvbmZpZy5zdHJva2VXaWR0aCBhcyBudW1iZXIpIDogMjtcbiAgICAgIGN0eC5maWxsU3R5bGUgPVxuICAgICAgICB0aGlzLl9jYWxjdWxhdGVTdHlsZShjb25maWcsIFwiZmlsbENvbG9yXCIsIFwiZmlsbE9wYWNpdHlcIikgfHwgXCIjN2RmOWZmMzNcIjtcbiAgICAgIGNvbnNvbGUubG9nKGN0eC5maWxsU3R5bGUpO1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4LnJvdW5kUmVjdChcbiAgICAgICAgcGl4ZWxDb29yZGluYXRlc1swXVswXSxcbiAgICAgICAgcGl4ZWxDb29yZGluYXRlc1swXVsxXSxcbiAgICAgICAgcGl4ZWxDb29yZGluYXRlc1sxXVswXSAtIHBpeGVsQ29vcmRpbmF0ZXNbMF1bMF0sXG4gICAgICAgIHBpeGVsQ29vcmRpbmF0ZXNbMV1bMV0gLSBwaXhlbENvb3JkaW5hdGVzWzBdWzFdLFxuICAgICAgICBcImJvcmRlclJhZGl1c1wiIGluIGNvbmZpZyA/IChjb25maWcuYm9yZGVyUmFkaXVzIGFzIG51bWJlcikgOiAwLFxuICAgICAgKTtcblxuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgY3R4LmZpbGwoKTtcbiAgICB9XG4gIH1cblxuICBfd2l0aG91dFpvb20oKSB7XG4gICAgaWYgKCF0aGlzLmdlb09iamVjdCB8fCAhdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnkpIHJldHVybjtcbiAgICBpZiAoIShcImdldFBpeGVsR2VvbWV0cnlcIiBpbiB0aGlzLmdlb09iamVjdC5nZW9tZXRyeSkpIHJldHVybjtcblxuICAgIGNvbnN0IHBpeGVsQm91bmRzID0gdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnlcbiAgICAgIC5nZXRQaXhlbEdlb21ldHJ5KClcbiAgICAgIC5nZXRCb3VuZHMoKSBhcyBudW1iZXJbXVtdO1xuXG4gICAgY29uc3QgZGVsdGFYID0gTWF0aC5taW4ocGl4ZWxCb3VuZHNbMF1bMF0sIHBpeGVsQm91bmRzWzFdWzBdKTtcbiAgICBjb25zdCBkZWx0YVkgPSBNYXRoLm1pbihwaXhlbEJvdW5kc1swXVsxXSwgcGl4ZWxCb3VuZHNbMV1bMV0pO1xuXG4gICAgY29uc3QgY2FudmFzID0gdGhpcy5fY3JlYXRlQ2FudmFzKCk7XG5cbiAgICBjb25zdCBwaXhlbENvb3JkaW5hdGVzID0gKFxuICAgICAgdGhpcy5nZW9PYmplY3QuZ2VvbWV0cnk/LmdldFBpeGVsR2VvbWV0cnkoKSBhcyBJUGl4ZWxQb2x5Z29uR2VvbWV0cnlcbiAgICApXG4gICAgICAuZ2V0Q29vcmRpbmF0ZXMoKVswXVxuICAgICAgLm1hcCgocG9pbnQpID0+IFtcbiAgICAgICAgcG9pbnRbMF0gLSBkZWx0YVggKyB0aGlzLnBhZGRpbmcsXG4gICAgICAgIHBvaW50WzFdIC0gZGVsdGFZICsgdGhpcy5wYWRkaW5nLFxuICAgICAgXSk7XG5cbiAgICBjb25zdCBjYW52YXNIZWlnaHQgPSBNYXRoLnJvdW5kKFxuICAgICAgICBNYXRoLm1heCguLi5waXhlbENvb3JkaW5hdGVzLmZsYXRNYXAoKGMpID0+IGNbMV0pKSxcbiAgICAgICksXG4gICAgICBjYW52YXNXaWR0aCA9IE1hdGgucm91bmQoXG4gICAgICAgIE1hdGgubWF4KC4uLnBpeGVsQ29vcmRpbmF0ZXMuZmxhdE1hcCgoYykgPT4gY1swXSkpLFxuICAgICAgKTtcblxuICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhc1dpZHRoICsgdGhpcy5wYWRkaW5nO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBjYW52YXNIZWlnaHQgKyB0aGlzLnBhZGRpbmc7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICBjb25zdCBjb25maWcgPSB0aGlzLmdlb09iamVjdC5vcHRpb25zLmdldEFsbCgpO1xuXG4gICAgY3R4LnN0cm9rZVN0eWxlID1cbiAgICAgIFwic3Ryb2tlQ29sb3JcIiBpbiBjb25maWcgPyAoY29uZmlnPy5zdHJva2VDb2xvciBhcyBzdHJpbmcpIDogXCIjMDAwMEZGXCI7XG4gICAgY3R4LmxpbmVXaWR0aCA9XG4gICAgICBcInN0cm9rZVdpZHRoXCIgaW4gY29uZmlnID8gKGNvbmZpZy5zdHJva2VXaWR0aCBhcyBudW1iZXIpIDogMjtcbiAgICBjdHguZmlsbFN0eWxlID1cbiAgICAgIFwiZmlsbENvbG9yXCIgaW4gY29uZmlnID8gKGNvbmZpZy5maWxsQ29sb3IgYXMgc3RyaW5nKSA6IFwiIzdkZjlmZjMzXCI7XG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhwaXhlbENvb3JkaW5hdGVzWzBdWzBdLCBwaXhlbENvb3JkaW5hdGVzWzBdWzFdKTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGl4ZWxDb29yZGluYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY3R4LmxpbmVUbyhwaXhlbENvb3JkaW5hdGVzW2ldWzBdLCBwaXhlbENvb3JkaW5hdGVzW2ldWzFdKTtcbiAgICB9XG5cbiAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5maWxsKCk7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhjYW52YXMudG9EYXRhVVJMKCkpO1xuXG4gICAgLy8gZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChjYW52YXMpO1xuICB9XG5cbiAgX2NhbGN1bGF0ZVN0eWxlID0gKFxuICAgIGNvbmZpZzogQ29uZmlnLFxuICAgIGNvbG9yUHJvcGVydHk6IFwiZmlsbENvbG9yXCIgfCBcInN0cm9rZUNvbG9yXCIsXG4gICAgb3BhY2l0eVByb3BlcnR5OiBcImZpbGxPcGFjaXR5XCIgfCBcInN0cm9rZU9wYWNpdHlcIixcbiAgKSA9PiB7XG4gICAgbGV0IHJldHVyblZhbHVlID0gXCJcIjtcbiAgICBpZiAoY29sb3JQcm9wZXJ0eSBpbiBjb25maWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwic3Ryb2tlXCIpO1xuICAgICAgcmV0dXJuVmFsdWUgPSBjb25maWdbY29sb3JQcm9wZXJ0eV07XG4gICAgICBpZiAoXCJzdHJva2VPcGFjaXR5XCIgaW4gY29uZmlnKSB7XG4gICAgICAgIGlmIChyZXR1cm5WYWx1ZS5sZW5ndGggPT09IDkpIHtcbiAgICAgICAgICBjb25zdCBoZXggPSBjb25maWdbY29sb3JQcm9wZXJ0eV07XG4gICAgICAgICAgY29uc3Qgb3BhY2l0eSA9XG4gICAgICAgICAgICAocGFyc2VJbnQocmV0dXJuVmFsdWUuc2xpY2UoNyksIDE2KSAvIDI1NSkgKlxuICAgICAgICAgICAgY29uZmlnW29wYWNpdHlQcm9wZXJ0eV07XG5cbiAgICAgICAgICBjb25zdCByID0gcGFyc2VJbnQoaGV4LnNsaWNlKDEsIDMpLCAxNiksXG4gICAgICAgICAgICBnID0gcGFyc2VJbnQoaGV4LnNsaWNlKDMsIDUpLCAxNiksXG4gICAgICAgICAgICBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDUsIDcpLCAxNik7XG4gICAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sJHtnfSwke2J9LCR7b3BhY2l0eX0pYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gY29uZmlnW2NvbG9yUHJvcGVydHldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgfVxuICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7QUFrQkE7QUFDQSxNQUFNQSxPQUFPLENBQUM7RUFFWkMsU0FBUyxHQUFXLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLFNBQVMsQ0FBQyxDQUFDLEVBQUUs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